<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TirAssist ‚Äî –ü–∞—Ä–∫–æ–≤–∫–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <link rel="stylesheet" href="style.css?v=22">
</head>
<body>

  <!-- Splash Screen -->
  <div id="splash-screen">
    <div id="splash-content">
      <img id="splash-logo" src="logo_tir.png" alt="TIR">
    </div>
  </div>

  <div id="map"></div>

  <!-- Layer toggle ‚Äî top-right standalone -->
  <button id="layer-btn" class="map-ctrl-btn map-layer-btn" title="–°–ª–æ–∏ –∫–∞—Ä—Ç—ã">
    <!-- satellite_alt icon (default: —Å–ø—É—Ç–Ω–∏–∫ —Ä–µ–∂–∏–º) -->
    <svg id="layer-icon-satellite" viewBox="0 -960 960 960" fill="currentColor" style="width:22px;height:22px">
      <path d="M560-32v-80q117 0 198.5-81.5T840-392h80q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T560-32Zm0-160v-80q50 0 85-35t35-85h80q0 83-58.5 141.5T560-192ZM222-57q-15 0-30-6t-27-17L23-222q-11-12-17-27t-6-30q0-16 6-30.5T23-335l127-127q23-23 57-23.5t57 22.5l50 50 28-28-50-50q-23-23-23-56t23-56l57-57q23-23 56.5-23t56.5 23l50 50 28-28-50-50q-23-23-23-56.5t23-56.5l127-127q12-12 27-18t30-6q15 0 29.5 6t26.5 18l142 142q12 11 17.5 25.5T895-730q0 15-5.5 30T872-673L745-546q-23 23-56.5 23T632-546l-50-50-28 28 50 50q23 23 22.5 56.5T603-405l-56 56q-23 23-56.5 23T434-349l-50-50-28 28 50 50q23 23 22.5 57T405-207L278-80q-11 11-25.5 17T222-57Zm0-79 42-42-142-142-42 42 142 142Zm85-85 42-42-142-142-42 42 142 142Zm184-184 56-56-142-142-56 56 142 142Zm198-198 42-42-142-142-42 42 142 142Zm85-85 42-42-142-142-42 42 142 142Z"/>
    </svg>
    <!-- map icon (—Å—Ö–µ–º–∞ —Ä–µ–∂–∏–º) -->
    <svg id="layer-icon-map" viewBox="0 0 24 24" fill="currentColor" class="hidden">
      <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/>
    </svg>
  </button>

  <!-- Right Map Controls ‚Äî zoom group (top) -->
  <div id="map-controls">
    <button id="zoom-in-btn" class="map-ctrl-btn map-ctrl-zoom" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
    <button id="zoom-out-btn" class="map-ctrl-btn map-ctrl-zoom" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚àí</button>
  </div>

  <!-- Right Map Controls ‚Äî settings/locate group (bottom) -->
  <div id="map-controls-bottom">
    <button id="filter-btn" class="map-ctrl-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤">
      <!-- settings icon -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41L9.25 5.35C8.66 5.59 8.12 5.92 7.63 6.29L5.24 5.33c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.3-.07.63-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
      </svg>
    </button>
    <button id="locate-btn" class="map-ctrl-btn" title="–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
      <!-- near_me icon -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z"/>
      </svg>
    </button>
  </div>

  <!-- Bottom Route Bar -->
  <div id="bottom-route-bar">
    <div class="route-row" id="route-row-from">
      <!-- near_me icon as from-indicator (orange) -->
      <span class="route-from-icon">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z"/>
        </svg>
      </span>
      <input type="text" id="route-from" placeholder="–û—Ç–∫—É–¥–∞" autocomplete="off">
      <button id="route-from-clear" class="route-icon-btn hidden" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úï</button>
      <button id="locate-in-route-btn" class="route-icon-btn" title="–í—Å—Ç–∞–≤–∏—Ç—å –º–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
        <!-- near_me icon -->
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z"/>
        </svg>
      </button>
    </div>
    <div class="route-bar-divider"></div>
    <div class="route-row" id="route-row-to">
      <span class="route-dot route-dot-to"></span>
      <input type="text" id="route-to" placeholder="–ö—É–¥–∞" autocomplete="off">
      <button id="route-to-clear" class="route-icon-btn hidden" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úï</button>
      <button id="route-go-btn" class="route-go-btn" title="–ù–∞–π—Ç–∏ –ø–∞—Ä–∫–æ–≤–∫–∏">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="5" y1="12" x2="19" y2="12"/>
          <polyline points="12 5 19 12 12 19"/>
        </svg>
      </button>
    </div>
    <button id="route-clear-btn" class="route-clear-btn hidden">‚úï –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
  </div>

  <!-- Filter / Dims Panel -->
  <div id="filter-panel" class="floating-panel hidden">
    <div id="panel-tabs">
      <button class="panel-tab active" data-tab="filters">–§–∏–ª—å—Ç—Ä—ã</button>
      <button class="panel-tab" data-tab="dims">–ì–∞–±–∞—Ä–∏—Ç—ã</button>
    </div>

    <div id="pane-filters">

      <!-- –¢–∏–ø –ø–∞—Ä–∫–æ–≤–∫–∏ -->
      <div class="filter-section">
        <div class="filter-section-title">–¢–∏–ø –ø–∞—Ä–∫–æ–≤–∫–∏</div>
        <div class="filter-chips">
          <button class="chip type-chip" data-type="parking">
            <img src="parking_free.png" width="16" style="vertical-align:middle;margin-right:3px"> Parking
          </button>
          <button class="chip type-chip" data-type="spot">
            <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;margin-right:3px">
              <rect x="1" y="1" width="22" height="22" rx="4" fill="white" stroke="#aaa" stroke-width="1.5"/>
              <text x="12" y="13.5" font-family="Arial,sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#333">P</text>
              <text x="12" y="19.5" font-family="Arial,sans-serif" font-size="4.5" font-weight="bold" text-anchor="middle" fill="#333">SPOT</text>
            </svg>Spot
          </button>
          <button class="chip type-chip" data-type="prom">üè≠ Prom</button>
          <button class="chip type-chip" data-type="–º–∞–≥–∞–∑–∏–Ω">
            <img src="shop.png" width="16" style="vertical-align:middle;margin-right:3px"> –ú–∞–≥–∞–∑–∏–Ω
          </button>
        </div>
      </div>

      <!-- –£–¥–æ–±—Å—Ç–≤–∞ -->
      <div class="filter-section">
        <div class="filter-section-title">–£–¥–æ–±—Å—Ç–≤–∞</div>
        <div class="filter-chips">
          <button class="chip" data-filter="toilet">üöΩ –¢—É–∞–ª–µ—Ç</button>
          <button class="chip" data-filter="shower">üöø –î—É—à</button>
          <button class="chip" data-filter="restaurant">‚òï –ö–∞—Ñ–µ</button>
          <button class="chip" data-filter="laundry"><img src="laundry.png" width="16" style="vertical-align:middle;margin-right:3px"> –ü—Ä–∞—á–µ—á–Ω–∞—è</button>
        </div>
      </div>

      <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
      <div class="filter-section">
        <div class="filter-section-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
        <div class="filter-chips">
          <button class="chip" data-filter="lighting">üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</button>
          <button class="chip" data-filter="fencing">üöß –û–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</button>
        </div>
      </div>

      <!-- –ö–∞—Ä—Ç—ã –æ–ø–ª–∞—Ç—ã -->
      <div class="filter-section">
        <div class="filter-section-title">–ö–∞—Ä—Ç—ã –æ–ø–ª–∞—Ç—ã</div>
        <div class="filter-chips">
          <button class="chip" data-filter="dkv">
            <img src="dkv.png" width="20" style="vertical-align:middle;margin-right:3px"> DKV
          </button>
          <button class="chip" data-filter="snap">
            <img src="snap.png" width="20" style="vertical-align:middle;margin-right:3px"> Snap
          </button>
        </div>
      </div>

      <!-- –û–ø–ª–∞—Ç–∞ -->
      <div class="filter-section">
        <div class="filter-section-title">–û–ø–ª–∞—Ç–∞</div>
        <div class="filter-chips">
          <button class="chip pay-btn" data-paid="false">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
          <button class="chip pay-btn" data-paid="true">–ü–ª–∞—Ç–Ω–æ</button>
        </div>
      </div>

      <button id="filter-clear" class="secondary-btn">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>

    <div id="pane-dims" class="hidden">
      <div class="dims-grid">
        <label class="dims-label">–í—ã—Å–æ—Ç–∞ (–º)<input id="dim-height" type="number" step="0.1" min="0" class="dims-input"></label>
        <label class="dims-label">–®–∏—Ä–∏–Ω–∞ (–º)<input id="dim-width" type="number" step="0.1" min="0" class="dims-input"></label>
        <label class="dims-label">–î–ª–∏–Ω–∞ (–º)<input id="dim-length" type="number" step="0.1" min="0" class="dims-input"></label>
        <label class="dims-label">–í–µ—Å (—Ç)<input id="dim-weight" type="number" step="1" min="0" class="dims-input"></label>
      </div>
      <button id="dims-save" class="primary-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>

  <!-- Add Parking FAB -->
  <button id="add-parking-btn" title="–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∫–æ–≤–∫—É">Ôºã</button>

  <!-- Add Parking Modal -->
  <div id="add-modal" class="hidden">
    <div id="add-modal-overlay" onclick="app.closeAddModal()"></div>
    <div id="add-modal-content">
      <div id="add-modal-header">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∫–æ–≤–∫—É</h3>
        <button id="add-modal-close" onclick="app.closeAddModal()">‚úï</button>
      </div>
      <div id="add-modal-body">

        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
          <input type="text" id="add-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Track Stop">
        </div>

        <!-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã -->
        <div class="form-group">
          <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã *</label>
          <div class="coords-row">
            <input type="text" id="add-coords" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã" autocomplete="off">
            <button id="add-coords-paste" class="coords-action-btn" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
              </svg>
            </button>
            <button id="add-coords-locate" class="coords-action-btn locate" title="–í—Å—Ç–∞–≤–∏—Ç—å –º–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- –¢–∏–ø –ø–∞—Ä–∫–æ–≤–∫–∏ -->
        <div class="form-group">
          <label>–¢–∏–ø –ø–∞—Ä–∫–æ–≤–∫–∏ *</label>
          <div class="type-chips-grid">
            <button class="type-chip-add active" data-type="parking">
              <img src="parking_free.png" width="20" alt="">
              <span>–ü–∞—Ä–∫–∏–Ω–≥</span>
            </button>
            <button class="type-chip-add" data-type="spot">
              <img src="spot.png" width="20" alt="">
              <span>Spot</span>
            </button>
            <button class="type-chip-add" data-type="prom">
              <img src="prom.png" width="20" alt="">
              <span>Prom</span>
            </button>
            <button class="type-chip-add" data-type="–º–∞–≥–∞–∑–∏–Ω">
              <img src="shop.png" width="20" alt="">
              <span>–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
          </div>
        </div>

        <!-- –£–¥–æ–±—Å—Ç–≤–∞ -->
        <div class="form-group">
          <label>–£–¥–æ–±—Å—Ç–≤–∞ *</label>
          <div class="services-grid">
            <label class="service-check"><input type="checkbox" value="shower">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M9 12c0-1.66 1.34-3 3-3 .35 0 .68.07 1 .18V4H5v16h7.18C10.07 19.32 9 17.79 9 16v-4zm11-5h-2V5c0-2.21-1.79-4-4-4-1.59 0-2.97.93-3.63 2.27C10.93 3.1 11.46 3 12 3c1.86 0 3.44 1.28 3.87 3H20c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1h-8v5c0 1.1.9 2 2 2s2-.9 2-2v-3h2v3c0 2.21-1.79 4-4 4-1.59 0-2.97-.93-3.63-2.27.21.17.41.35.63.49V20H5V2H3v20h18V9c0-.55-.45-1-1-1z"/></svg>
              –î—É—à
            </label>
            <label class="service-check"><input type="checkbox" value="toilet">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zm0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-5 8l2-2.5h6l2 2.5H7z"/></svg>
              –¢—É–∞–ª–µ—Ç
            </label>
            <label class="service-check"><input type="checkbox" value="restaurant">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4z"/></svg>
              –ö–∞—Ñ–µ
            </label>
            <label class="service-check"><input type="checkbox" value="laundry">
              <img src="laundry.png" width="18" height="18" style="object-fit:contain" alt="">
              –ü—Ä–∞—á–µ—á–Ω–∞—è
            </label>
            <label class="service-check"><input type="checkbox" value="lighting">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>
              –û—Å–≤–µ—â–µ–Ω–∏–µ
            </label>
            <label class="service-check"><input type="checkbox" value="fencing">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M22 12v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2H8v2H6v-2H4v2H2v-2H0v-2h2V8H0V6h2V4h2v2h2V4h2v2h2V4h2v2h2V4h2v2h2V4h2v2h2V6h-2v2h2v2h-2v2h2zM4 8v2h2V8H4zm4 0v2h2V8H8zm4 0v2h2V8h-2zm4 0v2h2V8h-2z"/></svg>
              –û–≥—Ä–∞–∂–¥–µ–Ω–∏–µ
            </label>
          </div>
        </div>

        <!-- –ü–ª–∞—Ç–Ω–æ / –ë–µ—Å–ø–ª–∞—Ç–Ω–æ -->
        <div class="form-group">
          <div class="pay-toggle-row">
            <button class="pay-btn-add active" data-paid="false">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
            <button class="pay-btn-add" data-paid="true">–ü–ª–∞—Ç–Ω–æ</button>
          </div>
        </div>

        <!-- –ö–∞—Ä—Ç—ã –æ–ø–ª–∞—Ç—ã -->
        <div class="form-group">
          <label>–ö–∞—Ä—Ç—ã –æ–ø–ª–∞—Ç—ã</label>
          <div class="services-grid">
            <label class="service-check"><input type="checkbox" value="dkv">
              <img src="dkv.png" width="22" style="object-fit:contain" alt=""> DKV
            </label>
            <label class="service-check"><input type="checkbox" value="snap">
              <img src="snap.png" width="22" style="object-fit:contain" alt=""> Snap
            </label>
          </div>
        </div>

        <!-- –û—Ç–ø—Ä–∞–≤–∏—Ç—å -->
        <button id="add-submit-btn" class="add-submit-styled">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>

      </div>
    </div>
  </div>

  <!-- Bottom Sheet -->
  <div id="bottom-sheet" class="hidden">
    <div id="sheet-drag-handle" onclick="app.hidePanel()">
      <div id="sheet-handle"></div>
    </div>
    <div id="sheet-content">
      <div id="sheet-header">
        <h2 id="parking-name"></h2>
        <span id="parking-distance" class="distance-badge hidden"></span>
      </div>
      <div id="parking-coords-row" class="hidden">
        <span id="parking-coords"></span>
        <button id="parking-coords-copy" class="copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã">üìã</button>
      </div>
      <div id="parking-meta">
        <span id="parking-rating"></span>
      </div>
      <div id="parking-description-row" class="sheet-row hidden">
        <span class="sheet-label">–û–ø–∏—Å–∞–Ω–∏–µ</span>
        <div id="parking-description-wrap">
          <p id="parking-description" class="sheet-description"></p>
          <button type="button" id="parking-description-toggle" class="description-toggle hidden">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
        </div>
      </div>
      <div id="services-row"></div>
      <button id="maps-btn" class="primary-btn maps-btn">
        üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
      </button>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast hidden"></div>

  <!-- Route loading overlay -->
  <div id="route-loading" class="hidden">
    <div class="route-loading-box">
      <div class="route-spinner"></div>
      <p>–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç‚Ä¶</p>
    </div>
  </div>

  <!-- JS Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/@tmcw/togeojson@5.8.1/dist/togeojson.umd.js"></script>
  <script src="app.js?v=22"></script>
</body>
</html>
